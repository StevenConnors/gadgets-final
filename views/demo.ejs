<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.0.0/Chart.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.23/p5.js"></script>
  </head>
  <body>

    <p>Welcome to <%= title %> - Demo page</p>

    <div> Here you can see the various actions this device can do</div>

    <div> Left Sensor: Open a bunch of pages </div>
    <div> Middle Sensor: Type some string</div>
    <div> Right Sensor: Move mouse </div>

    <br>
    <h2 id="action"> No actions </h2>




    <script type="text/javascript">

      var socket = io.connect();
      var allVals = [0, 0, 0];

      socket.on('sensorA', function (data) {
        // data.sensorVal is in the form X: ###
        // document.getElementById("piezoAvgA").innerHTML = data.num;
        allVals[0] = data.num;
        checkAllVals();
      });

      socket.on('sensorB', function (data) {
        // document.getElementById("piezoAvgB").innerHTML = data.num;
        allVals[1] = data.num;
      });

      socket.on('sensorC', function (data) {
        // document.getElementById("piezoAvgC").innerHTML = data.num;
        allVals[2] = data.num;
      });


      var alerted = false;
      var threshold = 300;

      var checkAllVals = function () {
        var tappedA = allVals[0] > threshold;
        var tappedB = allVals[1] > threshold;
        var tappedC = allVals[2] > threshold;

        if (!alerted) {
          if (tappedA || tappedB || tappedC) {
            alerted = true;

            if (tappedA) {
                var popup = window.open("http://hcii.cmu.edu");
                var popup = window.open("http://netflix.com");
                var popup = window.open("http://gmail.com");
                var popup = window.open("http://facebook.com");

                socket.emit('doActionA', { 
                
                });
                document.getElementById("action").innerHTML = "Action A was done";
            }

            if (tappedB) {
                socket.emit('doActionB', { 
                
                });
                document.getElementById("action").innerHTML = "Action B was done";
            }
            
            if (tappedC) {
                socket.emit('doActionC', { 
                
                });
                document.getElementById("action").innerHTML = "Action C was done";
            }
          }
        } else {
          if (!tappedA && !tappedB && !tappedC) {
            alerted = false;
          }
        }
      }




    </script>
  </body>
</html>
